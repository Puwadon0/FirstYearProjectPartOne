{% extends "navbar.html" %}
{% block title %}‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå{% endblock %}
{% block content %}
            <div class="max-w-6xl mx-auto p-4">
               <div class="flex items-center justify-between gap-2 mb-4">
                    <div class="flex items-center gap-2">
                        <span class="text-2xl"></span>
                        <div>
                            <h1 class="text-xl font-bold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏™‡πÇ‡∏°‡∏™‡∏£)</h1>
                            <p class="text-sm text-gray-400">‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                        </div>
                    </div>
                    
                    <a href="/" class="bg-white text-[#002d72] px-6 py-2 rounded-full font-bold text-sm hover:bg-gray-100 border border-[#002d72]">
                        + ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
                    </a>
                </div>

                <div class="bg-white shadow-md rounded-lg overflow-hidden">
                    <table class="w-full text-sm text-left border-collapse">
                        <thead class="bg-[#fcd34d] text-center font-bold">
                            <tr>
                                <th class="border p-3">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
                                <th class="border p-3">‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th class="border p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="border p-3">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</th>
                                <th class="border p-3">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
                                <th class="border p-3">‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
                                <th class="border p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</th>
                                <th class="border p-3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for act in activities %}
                            <tr class="text-center border-b hover:bg-gray-50">
                                <td class="border p-3 text-left font-medium">{{ act['act_name'] }}</td>
                                <td class="border p-3">{{ act['act_datetime'] }}</td>
                                <td class="border p-3">{{ act['act_location'] }}</td>
                                <td class="border p-3">{{ "{:,.0f}".format(act['act_cost'] if act['act_cost'] else 0) }} ‡∏ö‡∏≤‡∏ó</td>
                                <td class="border p-3">{{ act['act_created_by'] or '-' }}</td>
                                <td class="border p-3">
                                    {% if act['act_file'] %}
                                        <a href="{{ url_for('static', filename='uploads/' + act['act_file']) }}"
                                        class="text-blue-600 underline text-xs" target="_blank">üìÑ {{ act['act_file'] }}</a>
                                    {% else %}
                                        <span class="text-gray-400">-</span>
                                    {% endif %}
                                </td>
                                <td class="border p-3">
                                    {% if act['act_status'] == 'pending' %}
                                        <span class="px-3 py-1 rounded-full text-xs bg-yellow-100 text-yellow-700 font-bold">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                                    {% elif act['act_status'] == 'approved' %}
                                        <span class="px-3 py-1 rounded-full text-xs bg-green-100 text-green-700 font-bold">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
                                    {% else %}
                                        <span class="px-3 py-1 rounded-full text-xs bg-red-100 text-red-700 font-bold"> ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                                    {% endif %}
                                </td>
                                <td class="border p-3 text-center">
                                    {% if act['act_status'] == 'pending' %}
                                        <button class="edit-btn text-yellow-500 hover:text-yellow-700 font-bold"
                                     data-id="{{ act['act_id'] }}"
                                    data-name="{{ act['act_name'] }}"
                                    data-datetime="{{ act['act_datetime'] }}"
                                    data-location="{{ act['act_location'] }}"
                                    data-address="{{ act['act_address'] or '' }}"
                                    data-cost="{{ act['act_cost'] or 0 }}"
                                    data-status="{{ act['act_status'] }}"
                                    data-file="{{ act['act_file'] or '' }}"
                                    data-detail="{{ act['act_detail'] or '' }}"
                                    data-steps="{{ act['act_steps'] or '' }}"
                                    data-qa="{{ act['act_QA'] or '' }}"
                                    data-createdby="{{ act['act_created_by'] or '' }}"
                                    data-phone="{{ act['act_phone'] or '' }}"
                                    data-department="{{ act['act_department'] or '' }}"
                                    data-fiscalyear="{{ act['act_fiscal_year'] or '' }}"
                                    data-std="{{ act['act_std'] or 0 }}"
                                    data-other="{{ act['act_other'] or 0 }}">
                                        ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                    {% else %}
                                        <span class="text-gray-300 text-xs">‡∏•‡πá‡∏≠‡∏Ñ</span>
                                    {% endif %}
                                    {% if act['act_status'] == 'pending' %}
                                        <a href="/delete/{{ act['act_id'] }}"
                                        onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?')"
                                        class="text-red-500 hover:text-red-700 font-bold">‡∏•‡∏ö </a>
                                    {% else %}
                                        <span class="text-gray-300 text-xs">‡∏•‡πá‡∏≠‡∏Ñ</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
           <div id="editModal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="bg-[#1e3a5f] text-white px-6 py-4 rounded-t-2xl flex justify-between items-center sticky top-0 z-10">
                    <h2 class="font-bold text-lg">‚úè ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
                    <button onclick="closeEditModal()" class="text-white text-2xl">&times;</button>
                </div>
                <form id="editForm" method="POST" enctype="multipart/form-data" class="p-6 space-y-4">
                    <input type="hidden" id="edit_act_id">
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                        </div>
                        <div class="grid grid-cols-2 gap-4 p-4">
                            <div>
                                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                                <input type="text" name="department" id="edit_department" class="w-full border p-2 rounded">
                            </div>
                            <div>
                                <label>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
                                <input type="text" name="fiscalYear" id="edit_fiscalyear" class="w-full border p-2 rounded">
                            </div>
                            <div>
                                <label>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
                                <input type="text" name="responsiblePerson" id="edit_createdby" class="w-full border p-2 rounded">
                            </div>
                            <div>
                                <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                                <input type="text" name="phone" id="edit_phone" class="w-full border p-2 rounded">
                            </div>
                        </div>
                    </div>
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            2. ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                        </div>
                        <div class="p-4">
                            <input type="text" name="activityName" id="edit_name" class="w-full border p-2 rounded">
                        </div>
                    </div>
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            3. ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
                        </div>
                        <div class="p-4">
                            <input type="text" name="activityDatetime" id="edit_datetime" class="w-full border p-2 rounded">
                        </div>
                    </div>
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            4. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
                        </div>
                        <div class="p-4 space-y-3">
                            <input type="text" name="location" id="edit_location" class="w-full border p-2 rounded">
                            <input type="text" name="address" id="edit_address" class="w-full border p-2 rounded">
                        </div>
                    </div>
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            5. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                        </div>
                        <div class="grid grid-cols-2 gap-4 p-4">
                            <input type="number" name="participant_std" id="edit_std" class="border p-2 rounded">
                            <input type="number" name="participant_other" id="edit_other" class="border p-2 rounded">
                        </div>
                    </div>
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            6. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </div>
                        <div class="p-4 space-y-3">
                            <textarea name="objective" id="edit_detail" rows="3" class="w-full border p-2 rounded"></textarea>
                            <textarea name="steps" id="edit_steps" rows="3" class="w-full border p-2 rounded"></textarea>
                        </div>
                    </div>
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            7. ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
                        </div>
                        <div class="p-4">
                            <input type="number" name="cost" id="edit_cost" class="w-full border p-2 rounded">
                        </div>
                    </div>
                    <div class="border rounded-xl overflow-hidden">
                        <div class="bg-blue-800 text-white px-4 py-2 font-bold text-sm">
                            8. ‡πÑ‡∏ü‡∏•‡πå / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                        </div>
                        <div class="p-4 space-y-3">
                            <input type="file" name="project_file" class="w-full border p-2 rounded">
                            <textarea name="notes" id="edit_qa" rows="2" class="w-full border p-2 rounded"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded font-bold">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                    </div>

                </form>
            </div>
        </div>
    {% endblock %}
{% block scripts %}
<script>
     document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            const d = this.dataset;
            document.getElementById('edit_name').value = d.name;
            document.getElementById('edit_datetime').value = d.datetime;
            document.getElementById('edit_location').value = d.location;
            document.getElementById('edit_address').value = d.address;
            document.getElementById('edit_cost').value = d.cost;
            document.getElementById('edit_detail').value = d.detail;
            document.getElementById('edit_steps').value = d.steps;
            document.getElementById('edit_qa').value = d.qa;
            document.getElementById('edit_createdby').value = d.createdby;
            document.getElementById('edit_phone').value = d.phone;
            document.getElementById('edit_department').value = d.department;
            document.getElementById('edit_fiscalyear').value = d.fiscalyear;
            document.getElementById('edit_std').value = d.std;
            document.getElementById('edit_other').value = d.other;

            document.getElementById('editForm').action = `/edit/${d.id}`;
            document.getElementById('editModal').classList.remove('hidden');
        });
    });
    function closeEditModal() {
        document.getElementById('editModal').classList.add('hidden');
    }
</script>
{% endblock %}
